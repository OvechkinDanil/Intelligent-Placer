# Intelligent-Placer

## Постановка задачи

### Описание задачи

По поданной на вход фотографии нескольких предметов и многоугольнику, нарисованному на бумаге, лежащих на ярко-зеленой поверхности, понимать, можно ли расположить одновременно все эти предметы на плоскости так, чтобы они влезли в этот многоугольник. Предметы и горизонтальная поверхность, которые могут оказаться на фотографии, заранее известны.

### Входные и выходные значения

##### На вход:

Изображение в формате jpeg предметов и многоугольника, который нарисован темным маркером на белом листе бумаги. На фотографии лист бумаги и предметы лежат на поверхности не белого цвета. Лист бумаги с многоугольником всегда находится ниже предметов.

##### На выход:

Выдаёт **True** - если данный набор предметов может поместиться на данный многоугольник и **False** - в ином случае. Ответ, в зависимости от конфигурации, может быть получен, как в консоль, так и в файл.



### Требования

##### К фотографиями:
- Сняты на одном устройстве
- На широкоугольную камеру 12 мп
- При одинаковом освещении
- Цветные, без наложения каких-то фильтров
- Фокус должен быть на предмете
- Без размытостей фона
- Отсутствуют пересвеченные и серо-черные области
- Устройство находится под прямым углом к нормали поверхности
- Высота съемки - до 50 см

##### К предметам:
- Полностью помещаются на поверхности
- Полностью расположен на фото
- Не размываются с фоном(толщина линии границы не более 10 px)
- Не накладываются на другие предметы
- Нет одинаковых предметов
- Площадь предмета больше 1000 px^2

##### К поверхности:
- Светлая
- Горизонтальная
- Прямая
- Однотонная, без рисунков
- Отличается от цвета листа, на которой нарисован многоугольник(не белая)

### Данные

Все собранные данные можно посмотреть в директории **data**
- В директории **yes** лежат те предметы, на которых конечный алгоритм должен выдать ответ **yes**
- В директории **no** соответственно ответ **no**

## План
1. Поиск границ листа и фигуры <br/>
    1.1. Бинаризация изображения с помощью морфологических операций
2. Поиск границ предметов <br/>
    2.1. С помощью детектора Кэнни и морфологических операций определены границы предметов
3. Получение маски предметов и многоугольника <br/>
    3.1. По полученным контурам создаем бинарные маски многоугольника и предметов с помощью функций в OpenCV(boundingRect и pointPolygonTest) <br/>
4. Укладка предметов в многоугольник <br/>
    4.1. Для начала отсортируем маски предметов по их площадям, чтобы сначала пытаться разместить самый большой предмет<br/>
    4.2. Маска многоугольника заполнена значениями 0(False), а маски предметов - значениями 1(True)<br/>
    4.3. Расширим область многоугольника влево, вправо, вверх и вниз значениями 1(True), чтобы далее не было проблем при повороте предмета и накладывании его на многоугольник<br/>
    4.4. Вычислим позиции начала многоугольника относительно уже расширенной области<br/>
    4.5. Будем пытаться идти по всем доступным x и y многоугольника, и для каждой такой позиции будем разворачивать предмет от 0 до 360 градусов с шагом 20<br/>
    4.6. С помощью битовой операции AND можно найти те области, которые пересекаются с уже помещенными предметами или с областью вне многугольника<br/>
    4.7. Для укладки была использована бинарная операция XOR<br/>
    4.8. Если хоть один предмет не получилось уложить, то возвращаем False, а если получилось все - True<br/>
	
## TODO
1. Улучшить определения контуров предметов <br/>
   1.1. Есть несколько изображение в датасете, на которых алгоритм не может определить контуры предметов(test15_bad.jpg, test16_bad.jpg и test23_bad.jpg)

### Текущая статистика алгоритма

На текущем датасете из 18 изображений следующая точность:
- Для 15 изображений ответ правильный
- Для 3 изображений ответ не получен из-за ошибки определния контуров